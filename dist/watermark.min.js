!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).WaterMark={})}(this,(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var n=e(o((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports}))),r=o((function(t){function e(o){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(o)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})),i=e(r),a=o((function(t){var e=r.default;t.exports=function(t,o){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,o||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports}));e(a);var s=o((function(t){var e=r.default;t.exports=function(t){var o=a(t,"string");return"symbol"==e(o)?o:o+""},t.exports.__esModule=!0,t.exports.default=t.exports}));e(s);var l=e(o((function(t){function e(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}t.exports=function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports})));function c(t){if(!(this instanceof c))return new c(t);this.watermark=t,this.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,this.watermarkDom,this.oldOpts={width:0,height:0},this.option={childList:!0,attributes:!0,subtree:!0,attributeFilter:["style"],attributeOldValue:!0}}c.prototype.init=function(){if(this.MutationObserver){var t=this.callback(this.watermark);this.watermarkDom=new this.MutationObserver(t)}},c.prototype.callback=function(t){return function(e){var o=t._opts.boxId;e.forEach((function(e){e.removedNodes.forEach((function(e){e.id===o&&t.render()}))}))}},c.prototype.onListener=function(t,e){if(e.monitor&&this.watermarkDom){var o=document.getElementById(t.boxId);o&&(this.watermarkDom.observe(o.parentNode,this.option),o.shadowRoot&&o.shadowRoot.parentNode&&this.watermarkDom.observe(o.shadowRoot.parentNode,this.option))}},c.prototype.removeListener=function(){this.watermarkDom&&this.watermarkDom.disconnect()};var p={MutationListener:c};function u(t){if(!(this instanceof u))return new u}u.prototype.create=function(t,e,o){var n=this.createCanvas(e,o),r=document.createElement("div"),i=n.toDataURL(),a="\n    position:absolute;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n    pointer-events:none;\n    background-repeat:repeat;\n    background-image:url('".concat(i,"')");r.setAttribute("style",a),t.appendChild(r)},u.prototype.createCanvas=function(t,e){var o=document.createElement("canvas");o.setAttribute("width",t.boxWidth),o.setAttribute("height",t.boxHeight);var n=o.getContext("2d");return n.textAlign=e.textAlign,n.font="".concat(e.fontSize," ").concat(e.fontFamily),n.fillStyle="rgba(0, 0, 0, ".concat(e.fontAlpha,")"),n.rotate(e.rotateAngle),n.fillText(e.content,parseFloat(t.boxWidth)/2,parseFloat(t.boxHeight)),o},u.prototype.calaCtxData=function(t,e,o){var n,r;switch(t=t.data,e=e.data,o){case"R":n=0,r=3;break;case"G":n=1,r=2;break;case"B":n=2,r=1}for(var i=0;i<t.length;i++)i%4==n&&(0===e[i+r]&&t[i]%2==1||0!==e[i+r]&&t[i]%2==0)&&(255===t[i]?t[i]--:t[i]++);return t};var d={Canvas:u};function f(t){if(!(this instanceof f))return new f}f.prototype.create=function(t,e,o){for(var n,r,i=0;i<e.rows;i++){r=e.y+(e.pageHeight-e.allHeight)/2+(e.ySpace+e.boxHeight)*i;for(var a=0;a<e.cols;a++){n=e.x+(e.pageWidth-e.allWidth)/2+(e.xSpace+e.boxWidth)*a;var s=this.createItem(n,r,i,a,e,o);t.appendChild(s)}}},f.prototype.createItem=function(t,e,o,n,r,i){var a=document.createElement("div"),s=document.createTextNode(i.content);return a.appendChild(s),a.id=r.boxId+"_"+o+n,a.style.webkitTransform="rotate(-"+i.rotateAngle+"deg)",a.style.MozTransform="rotate(-"+i.rotateAngle+"deg)",a.style.msTransform="rotate(-"+i.rotateAngle+"deg)",a.style.OTransform="rotate(-"+i.rotateAngle+"deg)",a.style.transform="rotate(-"+i.rotateAngle+"deg)",a.style.visibility="",a.style.position=i.position,a.style.zIndex=i.zIndex,a.style.left=t+"px",a.style.top=e+"px",a.style.overflow="hidden",a.style.pointerEvents="none",a.style.opacity=i.fontAlpha,a.style.filter="alpha(opacity="+i.fontAlpha+"100)",a.style.fontSize=i.fontSize,a.style.fontFamily=i.fontFamily,a.style.lineHeight=i.fontSize,a.style.color=i.fontColor,a.style.textAlign=i.textAlign,a.style.display="block",a.style["-ms-user-select"]="none",a};var h={ShadowRoot:f};var y=function(t){return"[object Object]"==Object.prototype.toString.call(t)&&null!==t};var v=function(t){return"[object Function]"==Object.prototype.toString.call(t)};var m=function(t){return"[object Array]"==Object.prototype.toString.call(t)};var x=function(t){return"[object String]"==Object.prototype.toString.call(t)};var b=function(t){return"[object Number]"==Object.prototype.toString.call(t)};var g=function(t){return t instanceof Date};function w(t){return"[object Undefined]"==Object.prototype.toString.call(t)}var S,E,O,k,A=function(){var t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var o=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?o:3&o|8).toString(16)}))};Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,o=Number(arguments[1])||0;for(o<0&&(o+=e);o<e;){if(o in this&&this[o]===t)return o;o++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)n in this&&t.call(o,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=new Array(e),n=arguments[1],r=0;r<e;r++)r in this&&(o[r]=t.call(n,this[r],r,this));return o}),Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=new Array,n=arguments[1],r=0;r<e;r++)r in this&&t.call(n,this[r],r,this)&&o.push(val);return o}),Array.prototype.some||(Array.prototype.some=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)if(n in this&&t.call(o,this[n],n,this))return!0;return!1}),Array.prototype.every||(Array.prototype.every=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)if(n in this&&!t.call(o,this[n],n,this))return!1;return!0}),Object.keys||(Object.keys=(S=Object.prototype.hasOwnProperty,E=!{toString:null}.propertyIsEnumerable("toString"),k=(O=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(t){if("object"!==i(t)&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var o in t)S.call(t,o)&&e.push(o);if(E)for(var n=0;n<k;n++)S.call(t,O[n])&&e.push(O[n]);return e})),Object.assign||(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])}return o});var j=function(t,e,o){var n,r,i;return o=o||{},function(){r=this,i=Array.prototype.slice.call(arguments,0),clearTimeout(n),n=setTimeout((function(){o.immedi||(t.apply(r,i),r=i=null)}),e),o.immedi&&t.apply(r,i)}};var M={isObject:y,isFun:v,isArray:m,isString:x,isNumber:b,isDate:g,getUUId:A,assign:function(t,e){if("object"===i(e=e||{}))for(var o in e)w(e[o])||(t[o]=e[o]);return t},debounce:j,simulatedEvent:function(t,e,o,n){var r={canBubble:!0,cancelable:!0,eventType:"HTMLEvents"};n=Object.assign(r,n||{}),"object"==i(o)&&(n=Object.assign(r,o),o=void 0);var a="[object String]"===Object.prototype.toString.call(t)?document.getElementById(t):t,s=document.createEvent(n.eventType);s.initEvent(e,n.canBubble,n.cancelable),o&&a&&(a.value=o),a&&a.dispatchEvent(s)},mockMouse:function(t,e){var o="[object String]"==Object.prototype.toString.call(t)?document.getElementById(t):t,n=document.createEvent("MouseEvents");n.initMouseEvent("mousedown",!0,!0,window,0,e.x,e.y,e.x,e.y,!1,!1,!1,!1,0,null),o.dispatchEvent(n)},isIE:function(){var t=window.navigator.userAgent.toLowerCase(),e=/msie ([\d.]+)/,o=/trident.*rv:([\d.]+)/;return o.test(t)?{is:!0,v:t.match(o)[1]}:e.test(t)?{is:!0,v:t.match(e)[1]}:{is:!1,v:null}}};function _(){if(!(this instanceof _))return new _;this.type=window.addEventListener?1:2}_.prototype.on=function(t,e,o,n){1===this.type?t.addEventListener(e,o,n):t.attachEvent("on"+e,o)},_.prototype.off=function(t,e,o,n){1===this.type?t.removeEventListener(e,o):t.detachEvent(e,o)},_.prototype.dispatch=function(t,e){return t.dispatchEvent(e)};var T={EventListener:_},I=d.Canvas,L=h.ShadowRoot,W=M.isFun,H=M.mockMouse,C=M.isIE,z=new(0,T.EventListener);function P(t){if(!(this instanceof P))return new P(t);var e=t.renderType,o={1:function(){return W(document.createElement("div").attachShadow)&&!0},2:function(){return document.createElement("canvas").getContext&&!0},3:function(){return!0}};if(o[e]())this.type=e;else for(var n=1;n<4;n++){if(o[n]()){this.type=n;break}}this.init(t),this._opts=t}P.prototype.init=function(t){this.shadowRoot=this.getShadowRoot(t,t.containerBox)},P.prototype.render=function(t){var e=this._opts;(1===this.type?new L:2===this.type?new I:new L).create(1!==this.type?this.shadowRoot:this.shadowRoot.attachShadow({mode:"open"}),e,t),this.insertDom(e.containerBox,this.shadowRoot);var o=C();o.is&&parseInt(o.v)<11&&this.eventPenetrate(e)},P.prototype.getShadowRoot=function(t){var e=document.createElement("div");return e.id=t.boxId,e.setAttribute("style","pointer-events: none !important; display: block !important;overflow:hidden;"),e.style.position="absolute",e.style.zIndex=1e4,e.style.top=0,e.style.left=0,e.style.minWidth="100%",e.style.minHeight="100%",e},P.prototype.insertDom=function(t,e){t.style.position="relative";var o=t.children,n=Math.floor(Math.random()*(o.length-1));o[n]?t.insertBefore(e,o[n]):t.appendChild(e)},P.prototype.eventPenetrate=function(t){z.on(document.getElementById(t.boxId),"mousedown",(function(t){this.style.display="none";var e=document.elementFromPoint(t.clientX,t.clientY);return H(e,{x:t.clientX,y:t.clientY}),this.style.display="block",!1}))};var R=p.MutationListener,B={Adapter:P}.Adapter,D=M.getUUId;function F(t){if(!(this instanceof F))return new F;this.mutationListener=new R(this),this.mutationListener.init(),this.key=D()}F.prototype.init=function(t){this.opts=t||{};var e={boxId:t.boxId+"_"+this.key,pageOffTop:0,pageOffLeft:0,x:0,y:0,pageWidth:null,pageHeight:null,cols:0,rows:0,allWidth:0,allHeight:0,renderType:1};e.x=t.x+e.pageOffLeft,e.y=t.y+e.pageOffTop,e.renderType=t.renderType;var o=e.containerBox=t.containerNode&&document.getElementById(t.containerNode)||document.body;return this._calaBoxSize(e,t),this._getPageWidthHeight(e,o),this._caleMarkCount(e,t),this._calcTotalLength(e,t,o),this._opts=e,this},F.prototype.render=function(){console.log("渲染 水印！");var t=this.opts,e=this._opts;this.clear(e),new B(e).render(t),this.mutationListener.onListener(e,t)},F.prototype._calaBoxSize=function(t,e){var o=document.createElement("div");o.style.visibility="hidden",o.style.fontSize=e.fontSize,o.style.lineHeight=e.lineHeight,o.style.paddingLeft=e.xPadding,o.style.paddingRight=e.xPadding,o.style.paddingTop=e.yPadding,o.style.paddingBottom=e.yPadding,o.style.overflow="hidden",o.style.whiteSpace="nowrap",o.style.textOverflow="ellipsis",o.style.position="absolute",o.style.boxSizing="border-box",o.style.width="-webkit-max-content",o.style.width="-moz-max-content",o.style.width="max-content",document.body.appendChild(o),void 0!==o.textContent?o.textContent=e.content:o.innerText=e.content,t.boxWidth=o.offsetWidth+3,t.boxHeight=o.offsetHeight,o.parentNode.removeChild(o)},F.prototype._getPageWidthHeight=function(t,e){t.pageWidth=Math.max(e.scrollWidth,e.clientWidth),t.pageHeight=Math.max(e.scrollHeight,e.clientHeight)},F.prototype._caleMarkCount=function(t,e){t.cols=parseInt((t.pageWidth-t.x)/(t.boxWidth+e.xSpace)),t.xSpace=parseInt((t.pageWidth-t.x-t.boxWidth*t.cols)/t.cols),t.rows=parseInt((t.pageHeight-t.y)/(t.boxHeight+e.ySpace)),t.ySpace=parseInt((t.pageHeight-t.y-t.boxHeight*t.rows)/t.rows)},F.prototype._calcTotalLength=function(t,e){t.allWidth=t.x+t.boxWidth*t.cols+t.xSpace*(t.cols-1),t.allHeight=t.y+t.boxHeight*t.rows+t.ySpace*(t.rows-1)},F.prototype.clear=function(t){var e,o=document.getElementById(t.boxId);null==o||null===(e=o.parentNode)||void 0===e||e.removeChild(o),this.mutationListener.removeListener()},F.prototype.remove=function(){this.clear(),this.mutationListener.removeListener()};var N={WaterMark:F}.WaterMark,U=M.debounce,Y=M.assign,X={defaultOpt:{boxId:"wm_container_id",content:"",x:0,y:0,xSpace:0,ySpace:0,xPadding:"0px",yPadding:"0px",fontColor:"#000000",fontAlpha:.1,fontSize:"12px",lineHeight:"1",fontFamily:"Microsoft Yahei",rotateAngle:20,bgAlpha:.1,position:"absolute",zIndex:100,textAlign:"center",monitor:!0,containerNode:null,coverAreaId:null,onLoad:!0,onResize:!0,renderType:1}}.defaultOpt,G=new(0,T.EventListener),K=function(){return l((function t(e){n(this,t);var o=Y({},X);this.opts=Y(o,e||{});var r=this.watermark=new N;this._debounceFn=U((function(t){r.init(t).render()}),1e3)}),[{key:"init",value:function(){var t=this,e=this.opts;this.reload(e),e.onLoad&&G.on(window,"load",(function(){t._debounceFn(e)})),e.onResize&&G.on(window,"resize",(function(){t._debounceFn(e)}))}},{key:"reload",value:function(t){var e;t&&(e=Y({},X),this.opts=e=Y(e,t||{})),this.watermark.init(e).render()}},{key:"remove",value:function(){this.opts.onLoad&&G.off(window,"load"),this.opts.onResize&&G.off(window,"resize"),this.watermark.status=!1,this.watermark.remove()}}])}(),V=K,q={WaterMark:V};t.WaterMark=V,t.default=q,Object.defineProperty(t,"__esModule",{value:!0})}));
